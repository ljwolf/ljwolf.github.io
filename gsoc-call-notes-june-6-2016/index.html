<!DOCTYPE html>
<html lang="en-US">

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<head>
<meta charset="utf-8" />
<meta name="author" content="Levi John Wolf" />
<meta name="description" content="just a geograblog" />
<meta name="keywords" content="" />
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="generator" content="Hugo 0.37.1" />

<link rel="canonical" href="/gsoc-call-notes-june-6-2016/">
<base href="/" />
<meta property="og:title" content="GSOC Call Notes, June 6 2016" />
<meta property="og:description" content="I&rsquo;ve had to take a break from the spatial hierarchical linear modeling kick I&rsquo;ve been on recently to get back to some GSOC work.
Today, I had my weekly call with my mentors.
On today&rsquo;s call, my mentors and I discussed a few things.
Testing &amp; Merging of project code Since many of the improvements I&rsquo;m making to the library are module-by-module, I was advised to submit PRs when a logical unit of contribution is ready to ship." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/gsoc-call-notes-june-6-2016/" />



<meta property="article:published_time" content="2016-06-06T19:11:28&#43;00:00"/>

<meta property="article:modified_time" content="2016-06-06T19:11:28&#43;00:00"/>











<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="GSOC Call Notes, June 6 2016"/>
<meta name="twitter:description" content="I&rsquo;ve had to take a break from the spatial hierarchical linear modeling kick I&rsquo;ve been on recently to get back to some GSOC work.
Today, I had my weekly call with my mentors.
On today&rsquo;s call, my mentors and I discussed a few things.
Testing &amp; Merging of project code Since many of the improvements I&rsquo;m making to the library are module-by-module, I was advised to submit PRs when a logical unit of contribution is ready to ship."/>



<meta itemprop="name" content="GSOC Call Notes, June 6 2016">
<meta itemprop="description" content="I&rsquo;ve had to take a break from the spatial hierarchical linear modeling kick I&rsquo;ve been on recently to get back to some GSOC work.
Today, I had my weekly call with my mentors.
On today&rsquo;s call, my mentors and I discussed a few things.
Testing &amp; Merging of project code Since many of the improvements I&rsquo;m making to the library are module-by-module, I was advised to submit PRs when a logical unit of contribution is ready to ship.">


<meta itemprop="datePublished" content="2016-06-06T19:11:28&#43;00:00" />
<meta itemprop="dateModified" content="2016-06-06T19:11:28&#43;00:00" />
<meta itemprop="wordCount" content="932">



<meta itemprop="keywords" content="gsoc, python, geography, pysal, statistics, grad school,imported," />


<link rel="stylesheet" href="css/layout.css" />
<style type="text/css">
body {
  background-color: #f5f5f5;
  color: #444444;
}

a { color: #444444; }

pre {
  background: ;
  border: 1px solid #444444;
  border-radius: 5px;
}

code {
  background: ;
}

blockquote {
  background: ;
  border-left: 3px solid #444444;
}

table {
  margin: 1em auto;
  border-collapse: collapse;
}

table, th, td {
  border: 1px solid #444444;
}

th {
  background: #444444;
  color: #f5f5f5;
}

.siteTitle a { color: #e84848; }

.post .content h1{ color: #e84848; }
.post .content h2{ color: #e84848; }
.post .content h3{ color: #e84848; }
.post .content h4{ color: #e84848; }
.post .content h5{ color: #e84848; }
.post .content h6{ color: #e84848; }
.post .content a:hover { color: #e84848; }
.social-link:hover { color: #e84848; }
.nav-item-title:hover { color: #e84848; }
.tag a:hover { color: #e84848; }
.copyright { color: #404040 }
.poweredby { color: #404040 }
.poweredby a { color: #404040; }
.post-preview .title a{ color: #e84848; }
.content-item a:hover{
  text-decoration: underline;
  color: #e84848;
}
.post-list .title { color: #e84848; }
.rmore { color: #e84848; }
.terms .term a:hover {
  text-decoration: underline;
  color: #e84848;
}

</style>



<title>


     GSOC Call Notes, June 6 2016 

</title>

</head>


<body>
<div class="main">
<header>

<div class="header-bar">

  <nav>
    <div class="siteTitle">
      <a href="/">Yet Another Geographer</a>
    </div> 

    
    
    <a class="nav-item" href="/about/"><div class="nav-item-title">About | </div></a>
    
    <a class="nav-item" href="https://www.dropbox.com/s/y5mjkduq7bopzex/currvita.pdf?dl=0"><div class="nav-item-title"> CV |  </div></a>
    
    <a class="nav-item" href="http://www.bristol.ac.uk/geography/people/levi-j-wolf/overview.html"><div class="nav-item-title"> Bristol |  </div></a>
    
    <a class="nav-item" href="https://spatial.uchicago.edu"><div class="nav-item-title"> Chicago |  </div></a>
    
    <a class="nav-item" href="https://spatial.ucr.edu"><div class="nav-item-title"> UCR |  </div></a>
    
    <a class="nav-item" href="/teaching/"><div class="nav-item-title"> Teaching |  </div></a>
    
    <a class="nav-item active" href="/post/"><div class="nav-item-title">Posts</div></a>
    

  </nav>
</div>

<link rel="shortcut icon" type="image/jpg" href="/favicon.ico">


</header>


<article class="post">
    <h1 class="title"> GSOC Call Notes, June 6 2016 </h1>
    <div class="content"> <p>I&rsquo;ve had to take a break from the <a href="https://twitter.com/levijohnwolf/status/738600024431427584" target="_blank">spatial hierarchical linear modeling</a> <a href="http://ljwolf.org/post/145342859409/visual-display-of-complex-data-can-be-pretty" target="_blank">kick I&rsquo;ve been on recently</a> to get back to some GSOC work.</p>

<p>Today, I had my weekly call with my mentors.</p>

<p>On today&rsquo;s call, my mentors and I discussed a few things.</p>

<h2>Testing &amp; Merging of project code</h2>

<p>Since many of the improvements I&rsquo;m making to the library are module-by-module, I
was advised to submit PRs when a logical unit of contribution is ready to ship.
As I&rsquo;ve already been trying to use <a href="https://en.wikipedia.org/wiki/Test-driven_development" target="_blank">Test-Driven Development
principles</a> for my
project, writing a test of what I want the API changes to look like then writing
to that specification, this is relatively simple: the module is ready to submit
when the spec tests pass. So, now that much of the initial foray into the
labelled array API is done, I can beging to connect the tests &amp; submit PRs where
possible.</p>

<h2>Appropriate Targets for Labelled Array interfaces</h2>

<p>We also discussed how to extend the labelled array interface to other
submodules. For example, I have a good idea how a consistent labelled array
interface could look for Map Classifiers in the exploratory spatial data
analysis module. Other elements of that module should also be relatively
straightfoward to implement on labelled arrays, since all that&rsquo;s generally
needed is input interception: dataframe+column name needs to get correctly
parsed into numpy vectors. This is quite simple. The spatial regression module
also seems like a relatively straightforward place to add a labelled array
interface, using a similar strategy to what I&rsquo;ve already been doing in
<code>pysal.weights</code>. Defining a <code>from_formula</code> classmethod for spatial regression
modules would allow for specification of regressions using patsy &amp; pandas
dataframes.</p>

<p>But, in other parts of the library, like <code>region</code> or <code>spatial_dynamics</code>, it&rsquo;s
less clear as to what the labelled array interface should look like, so
I&rsquo;ll have to gain some perspective there.</p>

<h2>Remaining Confusion in weights construction</h2>

<p>I&rsquo;m running into some minor confusion because I&rsquo;m trying to make a call like
<code>from_dataframe(df, idVariable='FIPS')</code> equivalent to <code>from_shapefile(path,
idVariable='FIPS')</code>, and can&rsquo;t figure out when PySAL considers things ordered
vs. unordered.</p>

<p>For background, a spatial weights object in PySAL encodes the spatial
information in a geographic dataset, allowing estimation routines for various
spatial statistics or spatial models.  In doing this, it relates each
observation to every other observation, using information about the spatial
relationship between observations. In our library, these are used <em>all over the
place</em>.</p>

<p>But, in building a new, abstract interface to the weights constructors, I got
quite confused. Particularly, I was expecting to be able to write a pair of
<code>classmethod</code>s, say, <code>Rook.from_shapefile()</code> and <code>Rook.from_dataframe()</code>, that
have similar signatures and generate similar results. Something like
<code>from_dataframe(df, idVariable='FIPS')</code> being equivalent to
<code>from_shapefile(path, idVariable='FIPS')</code>. Unfortunately, it&rsquo;s somewhat
confusing to figure out how to make this work correctly, without making the API
incoonsistent. This is because PySAL handles <code>ids</code> in weights objects across its
various weights construction functions and classes in different ways. I think,
overall, we  expose four different variables or flags at different points in the
API that deal with how observations are indexed in a spatial weights object:</p>

<p><ol><li><code>ids</code> - ostensibly, a list of the ids to use corresponding to the input
data, considered in almost every weighting function.</li>
<li><code>idVariable</code> - a column name to get <code>ids</code> from when constructing weights from
file used in existing <code>from_shapefile</code> functions to generate <code>ids</code>.</li>
<li><code>id_order</code>- a list of indices used to re-index the names contained in <code>ids</code>
in an arbitrary order, impossible to set from <code>from_shapefile</code> functions but
used in the weights class&rsquo;s <code><strong>init</strong></code></li>
<li><code>id_order_set</code>- a boolean property of the weights object denoting whether
<code>id_order</code> has been explicitly set.</li>
</ol><p>To me, this is rather confusing, despite some <a href="https://github.com/pysal/pysal/issues/813" target="_blank">conversation trying to flesh this
out</a>.</p></p>

<p>First, all lists in python are ordered. So, when a user passes a list of ids in
as <code>ids</code>, its confusing that the order of this list is silently ignored. Second,
when we construct weights from shapefiles using an <code>idVariable</code>, the resulting
weights object has some peculiar properties: the <code>id_order</code> is set to the file
read order, but the <code>id_order_set</code> flag is always <code>False</code>. This is confusing for
a few reasons. First, shapefiles &amp; dbf files are implicitly ordered, so a column
in the <code>dbf</code> should correspond exactly to the order in which shapes are read,
barring data corruption. So, if I use a column of the dataframe to index the
shapefile, this should be considered ordered. Second, our docstring below seems
to imply that either <code>id_order_set</code> is <code>False</code> and <code>id_order</code> defaults to
lexicographic ordering, or <code>id_order_set</code> is <code>True</code>and <code>id_order</code> has special
structure:</p>

<pre><code>id_order : list
An ordered list of ids, defines the order of
observations when iterating over W if not set,
lexicographical ordering is used to iterate and the
id_order_set property will return False.  This can be
set after creation by setting the 'id_order' property.
</code></pre>

<p>But, one can easily generate an example where <code>id_order</code> is not lex ordered and <code>id_order_set</code> is <code>False</code>:</p>

<p><code>import pysal as ps</code></p>

<p><code>Qref = ps.queen_from_shapefile(ps.examples.get_path('south.shp'), idVariable='FIPS')</code></p>

<p><code>Qref.id_order_set</code></p>

<p><code>False</code></p>

<p><code>Qref.id_order</code></p>

<p><code>[u'54029',</code>
<code>u'54009',</code>
<code>u'54069',</code>
<code>u'54051',</code>
<code>u'10003',</code>
<code>...]</code></p>

<p><code>Qref.id_order_set</code></p>

<p><code>False</code></p>

<p>This is important because, when we construct weights from Dataframes, we need to
make a decision about what gets picked as an index and how to treat that index.
Right now, I&rsquo;ve made the executive decision to choose consistency in beahvior,
so that <code>from_dataframe(df, idVariable='POLYGON_ID')</code> will consider that column
to be ordered from the start. This means that the resulting weights will have
the same iteration order as weightsl <code>from_shapefile(filepath,
idVariable='POLYGON_ID')</code>, but the dataframe call will set the <code>id_order_set</code>
flag, while the shapefile classmethod does not.</p>

<p><small><i> imported from:</i> <a href='https://yetanothergeographer.tumblr.com/145529412394/gsoc-call-notes-june-6-2016'<tt>yetanothergeographer</tt></a></small></p>
 </div>
    <footer class="post-footer">

  <div class="post-footer-data">
    
<div class="tags">
    
      <div class="tag">
        <a href="/tags/gsoc">#gsoc</a>
      </div>
    
      <div class="tag">
        <a href="/tags/python"># python</a>
      </div>
    
      <div class="tag">
        <a href="/tags/geography"># geography</a>
      </div>
    
      <div class="tag">
        <a href="/tags/pysal"># pysal</a>
      </div>
    
      <div class="tag">
        <a href="/tags/statistics"># statistics</a>
      </div>
    
      <div class="tag">
        <a href="/tags/grad-school"># grad school</a>
      </div>
    
      <div class="tag">
        <a href="/tags/imported">#imported</a>
      </div>
    
</div>

    <div class="date"> Jun 6, 2016 </div>
  </div>

</footer>


  


</article>

  <footer>

  <div class="social-links-footer">

  
  <a href="mailto:levi.john.wolf@gmail.com"><div class="social-link">Email</div></a>
  

  
  <a href="https://github.com/ljwolf" target="_blank"><div class="social-link">GitHub</div></a>
  

  

  
  <a href="https://twitter.com/levijohnwolf" target="_blank"><div class="social-link">Twitter</div></a>
  

  

  <div class="social-link">
  <a href="/index.xml" target="_blank">RSS</a>
  </div>

</div>


  <div class="copyright">  </div>

  <div class="poweredby">
      thanks, <a href="https://gohugo.io/">Hugo</a>.
  </div>

  </footer>

</div> 

</body>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

</html>

